tags: [[git]]

Перед началом изучения ветвления необходимо понять что такое указать HEAD. 
HEAD - это файл в .git директории, который указывает либо на ветку с помощью refs/heads, либо на коммит sha-1. В зависимости от того куда указывает этот указатель его состояние будет меняться, например при указании на коммит его состояние будет считаться как detached - отделенное состояние. В таком состоянии коммиты будут сохраняться без какой-либо ветки и рано или поздно будут удалены сборщиком мусора гита, такие коммиты (не от ветки, а от коммита) делать не следует из-за возможности утери данных.

![[Pasted image 20221116231118.png|center|500]]

На картинке видно, что коммит 9e28 был сделан из коммита 1913, когда HEAD находился в состоянии detached, теперь переключиться на этот коммит можно только по его контрольной сумме sha-1, а в последсвии он вообще будет удален , крайне рекомендуется скопировать коммит с помощью git cherry-pick.

Ветки в гите устроены не так как в других СКВ, при создании новой ветки git не делает полную копию проекта, а просто создает новый файл в refs/heads/..., который будет указывать на тот же коммит, что и указывал HEAD в момент создания ветки. Таким образом ветвление в гите крайне рекомендуется.

Самый простой пример ветвления - создания ветки с испрвлением чего-либо. Переключившись на новую ветку мы создали коммит и теперь хотим объединить этот коммит с веткой master. Для этого будет использоваться стратегия fast-forward, которая просто перенесет указатель master на C3, так как никаких других изменений не было.

![[Pasted image 20221116231723.png|center]]

Кроме fast-forward стратегии существуют:
+ recursive (рекурсивная стратегия - самая распрастраненная стратегрия)
+ ort (относительно новая стратегия, работает как recursive, но значительно быстрее)
+ octopus (осьминог стратегрия - для объединения нескольких веток)
+ ours ("Наша" стратегия)
+ resolve (Устаревшая стратегия)

Стратегрия recursive будет применяться достаточно часто (как и ort), применяется она когда необходимо слиять несколько коммитов одной ветки с коммитами другой. Простой пример - на ветке iss было сделано несколько коммитов, а в это время другой разработчик внес изменения в main, таким образом обычную перемотку (fast-forward) использовать не получиться, гиту необходимо будет создать новый коммит слияния и выбрать стратегию для слияния

![[Pasted image 20221117003053.png|center]]

Рекурсивная стратегрия имеет ряд дополнительных флагов для определения слияния:
+ ours - Все конфликты будут решаться в сторону наших изменений
+ theirs - Все конфликты будут решаться в сторону удаленных изменений
+ ignore-all-space - игнорирует конфликты табов и пробелов
+ no-renames - не ищет переименованные файлы

![[Pasted image 20221117003225.png|center|400]]

При работе с удаленными репозиториями, гит будет создавать специальные ветки слижения, которые как и обычные ветки указывают на какой-либо коммит, но при переключении на них, HEAD так же как и переключении на коммит будет находиться в состоянии detached, поэтому если есть необходимость переключиться на удаленную ветку, которой еще нет локально, ее нужно сперва создать, а уже потом вносить в нее изменения.

В Git есть два способа внести изменения из одной ветки в другую: слияние и перебазирование. Как мы выяснили ранее, простейший способ выполнить слияние двух веток — это команда merge. Она осуществляет трёхстороннее слияние между двумя последними снимками сливаемых веток и самого недавнего общего для этих веток родительского снимка, создавая новый снимок (и коммит).

Перебазирование выполняется следующим образом - берётся общий родительский снимок двух веток (текущей, и той, поверх которой вы выполняете перебазирование), определяется дельта каждого коммита текущей ветки и сохраняется во временный файл, текущая ветка устанавливается на последний коммит ветки, поверх которой вы
выполняете перебазирование, а затем по очереди применяются дельты из временных файлов.

![[Pasted image 20221117004227.png]]

![[Pasted image 20221117004259.png]]

При перебазировании у коммитов меняются итоговые хеш суммы sha-1, из-за этого могут возникнуть конфликты при слиянии.

Книга 65-108 стр.

links:
+ https://www.youtube.com/watch?v=KbQFf4H493I